<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>some title</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!--optional color scales, you can specify your own color scale-->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <!-- <script type="text/javascript" src="assets/script/script.js"></script> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div class="row">
        <h1>Climate Change Beliefs</h1>
        <p>The map below represents climate change beliefs of democrat and republican populations in each U.S. state. The height of the dot indicated the percentage of the population that believes in the selected variable. The size of the dot is reflective of the number of electoral votes of that state.</p>
        <button class="btn btn-primary dem" onclick=datadem()>Democrats</button>
        <button class="btn btn-primary rep" onclick=datarep()>Republicans</button>
    </div>
    <div class="controls">
        <p class="textlabel">Select variable to view:</p>
        <select id="select_list" onchange="drawChart()">
            <option>Happening</option>
            <option>Human</option>
            <option>Harm US</option>
            <option>Regulate</option>
            <option>SupportRPS</option>
            <option>Fund Renewable</option>
            <option>Consensus</option>
            <option>Worried</option>
        </select>
        <!-- <button class="btn btn-dark" id="select_button" onclick="drawChart()">View Results</button> -->
        <div class="tooltip"></div>
    </div>

    <script>
    var margin = {top: 50 , right: 50, bottom: 100, left: 20}
    var width = window.innerWidth - margin.left - margin.right
    var height = 500 - margin.top - margin.bottom
    var chartWidth = 0.8*width

    var x = d3.scaleBand().range([0, chartWidth]).padding(0.1)
    var y = d3.scaleLinear().range([height, 0])
    var sizeScale = d3.scaleLinear().range([0, 20])
    var colorScale = d3.scaleOrdinal(d3.schemeDark2)

    var t = d3.transition().duration(3000)

    var tooltip=d3.select(".tooltip")

    var svg = d3.select("body").append("svg")
                    .attr("class","chart")
                    .attr("width", width)
                    .attr("height", height + margin.top + margin.bottom)

    var chart = svg.append("g")
                .attr("width", chartWidth)
                .attr("height", height)
                .attr("transform", "translate(" + margin.left + "," + margin.top +")");

    var title=chart.append("text")
        .attr("x", (chartWidth/2))
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")
        .attr("class","chartTitle")
        .style("font-size", "24px")
        .style("font-family","Raleway")
        .style("font-weight", 700)

    d3.json("assets/json/climate_data.json", function(error,data) {
        window.data=data
        drawChart()
        drawAxes()
        createLegend()
    });

    function datarep() {
        window.selected = d3.select("#select_list").property("value")
        console.log(selected)

        x.domain(data.map((d)=> d.GeoName))
        y.domain([0,100])
        sizeScale.domain([0,d3.max(data, (d)=>d.Electoral_Votes)])
        colorScale.domain(["Manufacturing", "Health care and social assistance" , "Retail trade", "Accommodation and food services"])

        var circle = chart.selectAll('circle.dot')
                        .data(data);

        //exit
        circle.exit()
            .transition(t)
            .attr('cx',0)
            .attr('cy',0)
            .remove()

        //update
        circle.attr("r",0).transition(t)
            .attr('cy', function(d) {
                if (selected == 'Regulate') {
                    return y(d.regulateRep);
                }
                else if (selected == 'SupportRPS') {
                    return y(d.supportRPSRep);
                }
                else if (selected == 'Fund Renewable') {
                    return y(d.fundrenewablesRep);
                }
                else if (selected == 'Happening') {
                    return y(d.happeningRep)
                }
                else if (selected == 'Human') {
                    return y(d.humanRep)
                }
                else if (selected == 'Consensus') {
                    return y(d.consensusRep)
                }
                else if (selected == 'Worried') {
                    return y(d.worriedRep)
                }
                else if (selected == 'Harm US') {
                    return y(d.harmUSRep)
                }
            })
            .attr('r', function(d) { return sizeScale(d.Electoral_Votes)})
            .attr("fill", (d) => colorScale(d.Industry));

        //enter
        title.text(selected);
        circle.enter().append("circle")
            .attr("class","dot")
            .attr("transform", "translate(40,0)")
            .attr('cx', (d)=>  x(d.GeoName))
            .attr('cy', function(d) {
                if (selected == 'Regulate') {
                    console.log("Drawing for Regulate")
                    return y(d.regulateRep)
                }
                else if (selected == 'SupportRPS') {
                    console.log("Drawing for SupportRPS")
                    return y(d.supportRPSRep)
                }
                else if (selected == 'Fund Renewable') {
                    console.log("Drawing for Fund Renewable")
                    return y(d.fundrenewablesRep);
                }
                else if (selected == 'Happening') {
                    console.log("Drawing for Happening")
                    return y(d.happeningRep)
                }
                else if (selected == 'Human') {
                    console.log("Drawing for Human")
                    return y(d.humanRep)
                }
                else if (selected == 'Consensus') {
                    console.log("Drawing for Consensus")
                    return y(d.consensusRep)
                }
                else if (selected == 'Worried') {
                    console.log("Drawing for Worried")
                    return y(d.worriedRep)
                }
                else if (selected == 'Harm US') {
                    console.log("Drawing for Harm US")
                    return y(d.harmUSRep)
                }
            })
            .attr('r',0)
            .transition(t)
            .attr('r', function(d) { return sizeScale(d.Electoral_Votes)})
            .attr("fill", (d) => colorScale(d.Industry));

        //enter & update
        chart.selectAll("circle.dot")
                    .on("mouseover", function(d) {
                        tooltip.transition(t)
                        .style("opacity", .9);
                        if (selected == 'Regulate') {
                            tooltip.text("Regulate: " + d.regulateRep)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'SupportRPS') {
                            tooltip.text("SupportRPS: " + d.supportRPSRep)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Fund Renewable') {
                            tooltip.text("Fund Renewable: " + d.fundrenewablesRep)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Happening') {
                            tooltip.text("Happening: " + d.happeningRep)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Human') {
                            tooltip.text("Human: " + d.humanRep)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Consensus') {
                            tooltip.text("Consensus: " + d.consensusRep)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Worried') {
                            tooltip.text("Worried: " + d.worriedRep)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Harm US') {
                            tooltip.text("Harm US: " + d.harmUSRep)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        tooltip.append("tspan").attr("class","label").text("Electoral Votes: " + d.Electoral_Votes)
                        tooltip.append("tspan").attr("class","label").text("State: " + d.GeoName)
                        tooltip.append("tspan").attr("class","label").text("Industry: " + d.Industry)
                    })
                    .on("mouseout", function (d) {
                        tooltip.transition(t).style("opacity", 0);
                    })
    }

    function drawChart() {
        window.selected = d3.select("#select_list").property("value")
        console.log(selected)

        x.domain(data.map((d)=> d.GeoName))
        y.domain([0,100])
        sizeScale.domain([0,d3.max(data, (d)=>d.Electoral_Votes)])
        colorScale.domain(["Manufacturing", "Health care and social assistance" , "Retail trade", "Accommodation and food services"])

        var circle = chart.selectAll('circle.dot')
                        .data(data);

        //exit
        circle.exit()
            .transition(t)
            .attr('cx',0)
            .attr('cy',0)
            .remove()

        //update
        circle.attr("r",0).transition(t)
            .attr('cy', function(d) {
                if (selected == 'Regulate') {
                    return y(d.regulateDem);
                }
                else if (selected == 'SupportRPS') {
                    return y(d.supportRPSDem);
                }
                else if (selected == 'Fund Renewable') {
                    return y(d.fundrenewablesDem);
                }
                else if (selected == 'Happening') {
                    return y(d.happeningDem)
                }
                else if (selected == 'Human') {
                    return y(d.humanDem)
                }
                else if (selected == 'Consensus') {
                    return y(d.consensusDem)
                }
                else if (selected == 'Worried') {
                    return y(d.worriedDem)
                }
                else if (selected == 'Harm US') {
                    return y(d.harmUSDem)
                }
            })
            .attr('r', function(d) { return sizeScale(d.Electoral_Votes)})
            .attr("fill", (d) => colorScale(d.Industry));

        //enter
        title.text(selected);
        circle.enter().append("circle")
            .attr("class","dot")
            .attr("transform", "translate(40,0)")
            .attr('cx', (d)=>  x(d.GeoName))
            .attr('cy', function(d) {
                if (selected == 'Regulate') {
                    console.log("Drawing for Regulate")
                    return y(d.regulateDem)
                }
                else if (selected == 'SupportRPS') {
                    console.log("Drawing for SupportRPS")
                    return y(d.supportRPSDem)
                }
                else if (selected == 'Fund Renewable') {
                    console.log("Drawing for Fund Renewable")
                    return y(d.fundrenewablesDem);
                }
                else if (selected == 'Happening') {
                    console.log("Drawing for Happening")
                    return y(d.happeningDem)
                }
                else if (selected == 'Human') {
                    console.log("Drawing for Human")
                    return y(d.humanDem)
                }
                else if (selected == 'Consensus') {
                    console.log("Drawing for Consensus")
                    return y(d.consensusDem)
                }
                else if (selected == 'Worried') {
                    console.log("Drawing for Worried")
                    return y(d.worriedDem)
                }
                else if (selected == 'Harm US') {
                    console.log("Drawing for Harm US")
                    return y(d.harmUSDem)
                }
            })
            .attr('r',0)
            .transition(t)
            .attr('r', function(d) { return sizeScale(d.Electoral_Votes)})
            .attr("fill", (d) => colorScale(d.Industry));

        //enter & update
        chart.selectAll("circle.dot")
                    .on("mouseover", function(d) {
                        tooltip.transition(t)
                        .style("opacity", .9);
                        if (selected == 'Regulate') {
                            tooltip.text("Regulate: " + d.regulateDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'SupportRPS') {
                            tooltip.text("SupportRPS: " + d.supportRPSDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Fund Renewable') {
                            tooltip.text("Fund Renewable: " + d.fundrenewablesDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Happening') {
                            tooltip.text("Happening: " + d.happeningDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Human') {
                            tooltip.text("Human: " + d.humanDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Consensus') {
                            tooltip.text("Consensus: " + d.consensusDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Worried') {
                            tooltip.text("Worried: " + d.worriedDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'Harm US') {
                            tooltip.text("Harm US: " + d.harmUSDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        tooltip.append("tspan").attr("class","label").text("Electoral Votes: " + d.Electoral_Votes)
                        tooltip.append("tspan").attr("class","label").text("State: " + d.GeoName)
                        tooltip.append("tspan").attr("class","label").text("Industry: " + d.Industry)
                    })
                    .on("mouseout", function (d) {
                        tooltip.transition(t).style("opacity", 0);
                    })
    }

    function drawAxes() {
        // x-axis
        chart.append("g")
            .attr("transform", "translate(30," + height + ")")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisBottom(x))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.8em")
            .attr("transform", "rotate(-90)");

        // y-axis
        chart.append("g")
            .attr("transform", "translate(30,0)")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisLeft(y))
    }

    function createLegend() {
        var legendRectSize = 20;
        var legendSpacing = 4;
        var legend = d3.select(".chart")
                .append("g")
                .attr("transform","translate(" + (chartWidth + margin.left + margin.right) + ",0)")
                .selectAll("g")
                .data(colorScale.domain())

        legend.enter().append('rect')
          .attr('width', legendRectSize)
          .attr('height', legendRectSize)
          .attr("transform",function(d,i) {
                              return "translate(0," + 30*i + ")";
                          })
          .style('fill', colorScale)
          .style('stroke', colorScale);

        legend.enter().append('text')
        .attr('x', legendRectSize + legendSpacing)
        .attr('y', legendRectSize - legendSpacing)
        .attr("class", "legendText")
        // .style("font-size",14)
          .attr("transform",function(d,i) {
                              return "translate(0," + 30*i + ")";
                          })              // NEW
          .text(function(d) { return d; });

        // legend.enter().append('rect')
        // .attr('width', 20)
        // .attr('height', 20)
        // .style('fill', colorScale)
        // .style('stroke', colorScale)
        // legend.enter().append("text")
        // .attr("transform",function(d,i) {
        //                     return "translate(30," + 5*i + ")";
        //                 })// + (chartWidth + margin.left +/ margin.right) + ",0)")
        // .text("sometext")
        // legend.append('text')
        // .attr('x', legendRectSize + legendSpacing)
        // .attr('y', legendRectSize - legendSpacing)
        // .text(function(d) { return d; });
    }
</script>

</body>
</html>
