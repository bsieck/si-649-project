<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>some title</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!--optional color scales, you can specify your own color scale-->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <!-- <script type="text/javascript" src="assets/script/script.js"></script> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div class="row">
        <h1>some text</h1>
        <p>Below, there are two graphs representing the democrat and republican populations in each U.S. state. The height of the dot indicated the percentage of that population that believe in xyz. The size of the dot is reflective of the number of electoral votes that state gets.</p>
        <button class="btn btn-primary dem" onclick=datadem()>Democrats</button>
        <button class="btn btn-primary rep" onclikc=datarep()>Republicans</button>
    </div>
    <div class="controls">
        <p class="textlabel">Select variable to view:</p>
        <select id="select_list">
            <option>Regulate</option>
            <option>SupportRPS</option>
            <option>Fund Renewable</option>
            <option>Happening</option>
            <option>Human</option>
            <option>Consensus</option>
            <option>Worried</option>
            <option>Harm US</option>
        </select>
        <button class="btn btn-dark" id="select_button" onclick="drawChart()">View Results</button>
        <div class="tooltip"></div>
    </div>
    <svg class="chart"></svg>

    <script>
    var margin = {top: 50 , right: 50, bottom: 100, left: 20}
    var width = 0.95*window.innerWidth - margin.left - margin.right
    var height = 400 - margin.top - margin.bottom

    var x = d3.scaleBand().range([0, width]).padding(0.1)
    var y = d3.scaleLinear().range([height, 0])
    var sizeScale = d3.scaleLinear().range([0, 20])
    var colorScale = d3.scaleOrdinal().range(["red", "yellow" , "green" , "blue"]);

    var tshort = d3.transition().duration(3000)
    var tlong = d3.transition().duration(3000)

    var tooltip=d3.select(".tooltip")

    var chart = d3.select(".chart")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top +")");

    var title=chart.append("text")
        .attr("x", (width/2))
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")
        .attr("class","chartTitle")
        .style("font-size", "24px")
        .style("font-family","Raleway")
        .style("font-weight", 700)

    d3.json("assets/json/climate_data.json", function(error,data) {
        window.data=data
        drawChart()
        drawAxes()
    });

    function drawChart() {
        window.selected = d3.select("#select_list").property("value")
        console.log(selected)

        x.domain(data.map((d)=> d.GeoName))
        y.domain([0,100])
        sizeScale.domain([0,d3.max(data, (d)=>d.Electoral_Votes)])
        colorScale.domain(["Manufacturing", "Health care and social assistance" , "Retail trade", "Accommodation and food services"])

        var circle = chart.selectAll('circle.dot')
                        .data(data);

        //exit
        circle.exit()
            .transition(tshort)
            .attr('cx',0)
            .attr('cy',0)
            .remove()

        //update
        circle.attr("r",0).transition(tlong)
            .attr('cy', function(d) {
                if (selected == 'Regulate') {
                    return y(d.regulateDem);
                }
                else if (selected == 'SupportRPS') {
                    return y(d.supportRPSDem);
                }
                else if (selected == 'Fund Renewable') {
                    return y(d.fundrenewablesDem);
                }
                else if (selected == 'Happening') {
                    return y(d.happeningDem)
                }
                else if (selected == 'Human') {
                    return y(d.humanDem)
                }
                else if (selected == 'Consensus') {
                    return y(d.consensusDem)
                }
                else if (selected == 'Worried') {
                    return y(d.worriedDem)
                }
                else if (selected == 'Harm US') {
                    return y(d.harmUSDem)
                }
            })
            .attr('r', function(d) { return sizeScale(d.Electoral_Votes)})
            .attr("fill", (d) => colorScale(d.Industry));

        //enter
        title.text(selected);

        circle.enter().append("circle")
            .attr("class","dot")
            .attr("transform", function(d) { return "translate(40,0)"; })
            .attr('cx', (d)=>  x(d.GeoName))
            .attr('cy', function(d) {
                if (selected == 'Regulate') {
                    console.log("Drawing for Regulate")
                    return y(d.regulateDem)
                }
                else if (selected == 'SupportRPS') {
                    console.log("Drawing for SupportRPS")
                    return y(d.supportRPSDem)
                }
                else if (selected == 'Fund Renewable') {
                    console.log("Drawing for Fund Renewable")
                    return y(d.fundrenewablesDem);
                }
                else if (selected == 'Happening') {
                    console.log("Drawing for Happening")
                    return y(d.happeningDem)
                }
                else if (selected == 'Human') {
                    console.log("Drawing for Human")
                    return y(d.humanDem)
                }
                else if (selected == 'Consensus') {
                    console.log("Drawing for Consensus")
                    return y(d.consensusDem)
                }
                else if (selected == 'Worried') {
                    console.log("Drawing for Worried")
                    return y(d.worriedDem)
                }
                else if (selected == 'Harm US') {
                    console.log("Drawing for Harm US")
                    return y(d.harmUSDem)
                }
            })
            .attr('r',0)
            .transition(tshort)
            .attr('r', function(d) { return sizeScale(d.Electoral_Votes)})
            .attr("fill", (d) => colorScale(d.Industry));

        //enter & update
        chart.selectAll("circle.dot")
                    .on("mouseover", function(d) {
                        tooltip.transition(tshort)
                        .style("opacity", .9);

                        if (selected == 'Regulate') {
                            tooltip.text("Regulate: " + d.regulateDem)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                        else if (selected == 'SupportRPS') {
                            tooltip.append("tspan").attr("class","label").text("SupportRPS: " + d.supportRPSDem)
                        }
                        else if (selected == 'Fund Renewable') {
                            tooltip.append("tspan").attr("class","label").text("Fund Renewable: " + d.fundrenewablesDem);
                        }
                        else if (selected == 'Happening') {
                            tooltip.append("tspan").attr("class","label").text("Happening: " + d.happeningDem)
                        }
                        else if (selected == 'Human') {
                            tooltip.append("tspan").attr("class","label").text("Human: " + d.humanDem)
                        }
                        else if (selected == 'Consensus') {
                            tooltip.append("tspan").attr("class","label").text("Consensus: " + d.consensusDem)
                        }
                        else if (selected == 'Worried') {
                            tooltip.append("tspan").attr("class","label").text("Worried: " + d.worriedDem)
                        }
                        else if (selected == 'Harm US') {
                            tooltip.append("tspan").attr("class","label").text("Harm US: " + d.harmUSDem)
                        }
                        tooltip.append("tspan").attr("class","label").text("Electoral Votes: " + d.Electoral_Votes)
                    })
                    .on("mouseout", function (d) {
                        tooltip.transition(tshort).style("opacity", 0);
                    })
    }

    function drawAxes() {
        // x-axis
        chart.append("g")
            .attr("transform", "translate(30," + height + ")")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisBottom(x))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.8em")
            .attr("transform", "rotate(-90)");

        // y-axis
        chart.append("g")
            .attr("transform", "translate(30,0)")
            .style("font-family","Raleway")
            .style("font-size", "11px")
            .call(d3.axisLeft(y))
    }

    function createLegend() {

    }
</script>

</body>
</html>
